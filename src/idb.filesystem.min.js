(function(f){function m(a){var c=a.code,b=a.name;Object.defineProperty(this,"code",{set:function(a){c=a},get:function(){return c}});Object.defineProperty(this,"name",{set:function(a){b=a},get:function(){return b}})}function s(a,c){var b=c;c[0]!=g&&(b=a,b=a!=g?b+(g+c):b+c);for(var b=b.split(g),d=0;d<b.length;++d)".."==b[d]&&(b[d-1]="",b[d]="");b=b.filter(function(a){return a}).join(g);b[0]!=g&&(b=g+b);b=b.replace(/\.\//g,g);b=b.replace(/\/\//g,g);b=b.replace(/\/\./g,g);b[b.length-1]==g&&b!=g&&(b=b.substring(0,
b.length-1));return b}function t(a){var c=null;this.size=a.size||0;this.name=a.name||"";this.type=a.type||"";this.lastModifiedDate=a.lastModifiedDate||null;Object.defineProperty(this,"blob_",{enumerable:!0,get:function(){return c},set:function(a){c=a;this.size=c.size;this.name=c.name;this.type=c.type;this.lastModifiedDate=c.lastModifiedDate}.bind(this)})}function x(a){if(!a)throw Error("Expected fileEntry argument to write.");var c=0,b=a.file_?a.file_.blob_:null;Object.defineProperty(this,"position",
{get:function(){return c}});Object.defineProperty(this,"length",{get:function(){return b?b.size:0}});this.seek=function(a){c=a;if(c>this.length)c=this.length;0>c&&(c+=this.length);0>c&&(c=0)};this.truncate=function(a){b=b?a<this.length?b.slice(0,a):new Blob([b,new Uint8Array(a-this.length)],{type:b.type}):new Blob([]);c=0;this.write(b)};this.write=function(d){if(!d)throw Error("Expected blob argument to write.");if(this.onwritestart)this.onwritestart();if(b){var e=b.slice(0,c),g=b.slice(c+d.size),
f=c-e.size;0>f&&(f=0);b=new Blob([e,new Uint8Array(f),d,g],{type:b.type})}else b=new Blob([d],{type:d.type});a.file_.blob_=b;a.file_.lastModifiedDate=d.lastModifiedDate||null;h.put(a,function(){c+=d.size;if(this.onwriteend)this.onwriteend()}.bind(this),this.onerror)}}function y(a){var c=!1;this.readEntries=function(b,d){if(!b)throw Error("Expected successCallback argument.");c?b([]):h.getAllEntries(a.fullPath,function(a){c=!0;b(a)},d)}}function u(a,c){this.modificationTime_=a||null;this.size_=c||
0}function o(){}function j(a){this.file_=null;Object.defineProperty(this,"isFile",{enumerable:!0,get:function(){return!0}});Object.defineProperty(this,"isDirectory",{enumerable:!0,get:function(){return!1}});if(a)this.file_=a.file_,this.name=a.name,this.fullPath=a.fullPath,this.filesystem=a.filesystem}function i(a){Object.defineProperty(this,"isFile",{enumerable:!0,get:function(){return!1}});Object.defineProperty(this,"isDirectory",{enumerable:!0,get:function(){return!0}});if(a)this.name=a.name,this.fullPath=
a.fullPath,this.filesystem=a.filesystem}function z(a){v=a==f.TEMPORARY?"Temporary":"Persistent";this.name=(location.protocol+location.host).replace(/:/g,"_")+":"+v;this.root=new i;this.root.fullPath=g;this.root.filesystem=this;this.root.name=""}function k(a){switch(a.target.errorCode){case 12:console.log("Error - Attempt to open db with a lower version than the current one.");break;default:console.log("errorCode: "+a.target.errorCode)}console.log(a,a.code,a.message)}if(!f.requestFileSystem&&!f.webkitRequestFileSystem){var p=
f.indexedDB||f.mozIndexedDB||f.msIndexedDB;if(p){f.TEMPORARY=0;f.PERSISTENT=1;if(void 0===f.FileError)window.FileError=function(){},FileError.prototype.prototype=Error.prototype;FileError.INVALID_MODIFICATION_ERR=9;FileError.NOT_FOUND_ERR=1;m.prototype=FileError.prototype;m.prototype.toString=Error.prototype.toString;var l=new m({code:FileError.INVALID_MODIFICATION_ERR,name:"INVALID_MODIFICATION_ERR"}),q=new m({code:1E3,name:"Not implemented"}),r=new m({code:FileError.NOT_FOUND_ERR,name:"Not found"}),
n=null,v="temporary",h={db:null},g="/",w=String.fromCharCode(g.charCodeAt(0)+1);t.prototype.constructor=t;u.prototype={get modificationTime(){return this.modificationTime_},get size(){return this.size_}};o.prototype={name:null,fullPath:null,filesystem:null,copyTo:function(){throw q;},getMetadata:function(a,c){if(!a)throw Error("Expected successCallback argument.");try{this.isFile?a(new u(this.file_.lastModifiedDate,this.file_.size)):c(new m({code:1001,name:"getMetadata() not implemented for DirectoryEntry"}))}catch(b){c&&
c(b)}},getParent:function(){throw q;},moveTo:function(){throw q;},remove:function(a,c){if(!a)throw Error("Expected successCallback argument.");h["delete"](this.fullPath,function(){a()},c)},toURL:function(){return"filesystem:"+(location.protocol+"//"+location.host)+g+v.toLowerCase()+this.fullPath}};j.prototype=new o;j.prototype.constructor=j;j.prototype.createWriter=function(a){a(new x(this))};j.prototype.file=function(a,c){if(!a)throw Error("Expected successCallback argument.");if(null==this.file_)if(c)c(r);
else throw r;else{var b=null==this.file_.blob_?this.file_:this.file_.blob_;b.lastModifiedDate=this.file_.lastModifiedDate;a(b)}};i.prototype=new o;i.prototype.constructor=i;i.prototype.createReader=function(){return new y(this)};i.prototype.getDirectory=function(a,c,b,d){a=s(this.fullPath,a);h.get(a,function(e){c||(c={});!0===c.create&&!0===c.exclusive&&e?d&&d(l):!0===c.create&&!e?(e=new i,e.name=a.split(g).pop(),e.fullPath=a,e.filesystem=n,h.put(e,b,d)):!0===c.create&&e?e.isDirectory?b(new i(e)):
d&&d(l):(!c.create||!1===c.create)&&!e?a==g?(e=new i,e.name="",e.fullPath=g,e.filesystem=n,b(e)):d&&d(r):(!c.create||!1===c.create)&&e&&e.isFile?d&&d(l):b(new i(e))},d)};i.prototype.getFile=function(a,c,b,d){a=s(this.fullPath,a);h.get(a,function(e){c||(c={});!0===c.create&&!0===c.exclusive&&e?d&&d(l):!0===c.create&&!e?(e=new j,e.name=a.split(g).pop(),e.fullPath=a,e.filesystem=n,e.file_=new t({size:0,name:e.name,lastModifiedDate:new Date}),h.put(e,b,d)):!0===c.create&&e?e.isFile?b(new j(e)):d&&d(l):
(!c.create||!1===c.create)&&!e?d&&d(r):(!c.create||!1===c.create)&&e&&e.isDirectory?d&&d(l):b(new j(e))},d)};i.prototype.removeRecursively=function(a,c){if(!a)throw Error("Expected successCallback argument.");this.remove(a,c)};h.open=function(a,c,b){var d=this,a=a.replace(":","_"),e;try{e=p.open(a,{version:1,storage:"temporary"})}catch(g){e=p.open(a)}e.onerror=b||k;e.onupgradeneeded=function(a){d.db=a.target.result;d.db.onerror=k;d.db.objectStoreNames.contains("entries")||d.db.createObjectStore("entries")};
e.onsuccess=function(a){d.db=a.target.result;d.db.onerror=k;c(a)};e.onblocked=b||k};h.close=function(){this.db.close();this.db=null};h.drop=function(a,c){if(this.db){var b=p.deleteDatabase(this.db.name);b.onsuccess=function(b){a(b)};b.onerror=c||k;h.close()}};h.get=function(a,c,b){if(this.db){var d=this.db.transaction(["entries"],"readonly"),a=IDBKeyRange.bound(a,a+w,!1,!0),e=d.objectStore("entries").get(a);d.onabort=b||k;d.oncomplete=function(){c(e.result)}}};h.getAllEntries=function(a,c,b){if(this.db){var d=
[],e=null;a!=g&&(e=IDBKeyRange.bound(a+g,a+w,!1,!0));var f=this.db.transaction(["entries"],"readonly");f.onabort=b||k;f.oncomplete=function(){d=d.filter(function(b){var c=b.fullPath.split(g).length,d=a.split(g).length;if(a==g&&c<d+1||a!=g&&c==d+1)return b});c(d)};f.objectStore("entries").openCursor(e).onsuccess=function(a){if(a=a.target.result){var b=a.value;d.push(b.isFile?new j(b):new i(b));a["continue"]()}}}};h["delete"]=function(a,c,b){if(this.db){var d=this.db.transaction(["entries"],"readwrite");
d.oncomplete=c;d.onabort=b||k;a=IDBKeyRange.bound(a,a+w,!1,!0);d.objectStore("entries")["delete"](a)}};h.put=function(a,c,b){if(this.db){var d=this.db.transaction(["entries"],"readwrite");d.onabort=b||k;d.oncomplete=function(){c(a)};d.objectStore("entries").put(a,a.fullPath)}};f.addEventListener("beforeunload",function(){h.db.close()},!1);f.requestFileSystem=function(a,c,b,d){a!=f.TEMPORARY&&a!=f.PERSISTENT&&d?d(l):(n=new z(a,c),h.open(n.name,function(){b(n)},d))};f.resolveLocalFileSystemURL=function(a,
c,b){b&&b(q)};if(f===window&&f.RUNNING_TESTS)f.Entry=o,f.FileEntry=j,f.DirectoryEntry=i,f.resolveToFullPath_=s,f.Metadata=u}}})(self);
